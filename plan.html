<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PLAN SHUTDOWN ENTRY</title>

<style>
body{font-family:Segoe UI,Roboto,Arial;background:#eef2f5;margin:0}
header{background:#0f3d3e;color:white;padding:12px;text-align:center;font-size:18px;font-weight:600}
.container{padding:16px;max-width:480px;margin:auto}
.card{background:white;padding:16px;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,.1);margin-bottom:16px}
input,select,button{width:100%;padding:12px;margin-top:8px;border-radius:10px;border:1px solid #ccc;font-size:14px}
button{background:#0f3d3e;color:white;font-weight:700;border:none}
.red{background:#ff9999}
.green{background:#ccffcc}
</style>
</head>

<body>
<header>PLAN SHUTDOWN ENTRY</header>

<div class="container">

<div class="card">
<input id="installation" readonly>
<input id="entryby" readonly>
<select id="feeder"></select>
<input type="date" id="date">
<input type="time" id="from">
<input type="time" id="to">
<button onclick="savePlan()">SAVE PLAN</button>
</div>

<div class="card">
<h3>Plan List</h3>
<table width="100%" border="1" id="planTable"></table>
</div>

</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbyd0xvIH4jYe1CElD7BVFSNJzsfyu0IktPQx16AVPCYn5OKG9z8M11bGAQ_VR5KGav4WQ/exec";

// auto values (login se bhi la sakte ho)
installation.value="AREA-IV";
entryby.value="SYSTEM USER";

const FEEDERS=["FEEDER-1","FEEDER-2","FEEDER-3"];
FEEDERS.forEach(f=>feeder.innerHTML+=`<option>${f}</option>`);

function savePlan(){
 fetch(SCRIPT_URL+"?"+new URLSearchParams({
  action:"plan",
  feeder:feeder.value,
  date:date.value,
  from:from.value,
  to:to.value,
  installation:installation.value,
  entryby:entryby.value
 })).then(r=>r.text()).then(a=>{
  alert(a);
  loadPlans();
 });
}

function loadPlans(){
 fetch(SCRIPT_URL+"?action=getallplans")
 .then(r=>r.json())
 .then(data=>{
  let html="<tr><th>Date</th><th>From</th><th>To</th><th>Feeder</th></tr>";
  let today=new Date();today.setHours(0,0,0,0);
  data.reverse().forEach(r=>{
   let d=new Date(r.date);d.setHours(0,0,0,0);
   let cls=d>=today?"red":"green";
   html+=`<tr class="${cls}">
    <td>${r.date}</td>
    <td>${r.from}</td>
    <td>${r.to}</td>
    <td>${r.feeder}</td>
   </tr>`;
  });
  planTable.innerHTML=html;
 });
}

loadPlans();
</script>
</body>
</html>
