<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shutdown & Resume Power Management</title>
<style>
body{font-family:Segoe UI,Arial;background:#f4f6f8;margin:0}
header{background:#1f3a5f;color:#fff;padding:12px 20px;font-size:20px}
.container{padding:20px}
.card{background:#fff;padding:20px;border-radius:6px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
h3{margin-top:0;color:#1f3a5f}
label{display:block;margin-top:10px;font-weight:600}
select,input,textarea{width:100%;padding:8px;margin-top:4px}
textarea{resize:vertical}
button{padding:10px 18px;border:none;border-radius:4px;cursor:pointer}
.btn-login{background:#3498db;color:#fff}
.btn-shutdown{background:#e74c3c;color:#fff}
.btn-resume{background:#27ae60;color:#fff}
.footer{position:fixed;bottom:0;width:100%;background:#ecf0f1;padding:10px;text-align:center}
#msg{margin-top:5px;font-weight:bold}
</style>
</head>
<body>

<header>Shutdown & Resume Power Management</header>

<div class="container">

<!-- Login Card -->
<div class="card" id="loginCard">
<h3>Operator Login</h3>
<label>Username</label>
<input type="text" id="loginUser" placeholder="121318">

<label>Password</label>
<input type="password" id="loginPass" placeholder="1234">

<label>Operator Name</label>
<input type="text" id="loginName" placeholder="Bhavesh Parmar">

<label>Installation Name</label>
<input type="text" id="loginInst" placeholder="LIMBODARA-GGS-1">

<br><br>
<button class="btn-login" onclick="login()">Login</button>
</div>

<!-- Shutdown Card -->
<div class="card" id="shutdownCard" style="display:none">
<h3>Shutdown Entry</h3>

<label>Feeder</label>
<select id="sd_feeder"></select>

<label>Shutdown Time</label>
<input type="datetime-local" id="sd_time">

<label>Shutdown Type</label>
<select id="sd_type">
<option>PLAN PSD</option>
<option>PARTIAL PLAN PSD</option>
<option>UNPLAN PSD</option>
<option>PARTIAL UNPLAN PSD</option>
</select>

<label>Information</label>
<textarea id="sd_info"></textarea>

<br><br>
<button class="btn-shutdown" onclick="submitShutdown()">Submit Shutdown</button>
</div>

<!-- Resume Card -->
<div class="card" id="resumeCard" style="display:none">
<h3>Resume Entry</h3>

<label>Feeder</label>
<select id="rs_feeder"></select>

<label>Resume Time</label>
<input type="datetime-local" id="rs_time">

<label>Production Loss</label>
<input type="number" id="rs_loss">

<label>DG Deployed</label>
<input type="number" id="rs_dg">

<label>Remarks</label>
<textarea id="rs_rem"></textarea>

<br><br>
<button class="btn-resume" onclick="submitResume()">Submit Resume</button>
</div>

</div>

<div class="footer">
<div id="msg"></div>
</div>

<script>
// Google WebApp URL
const WEBAPP_URL="https://script.google.com/macros/s/AKfycbz1g6vziMziteLRvxrVRtVr-xUOFdLrpDN4OqoiaDEv-c2h1-fUHk9nq2LueN4XuHHsKQ/exec"; // Replace with your Apps Script WebApp URL

// Installation-wise feeders
const INSTALLATION_FEEDERS={
"LIMBODARA-GGS-1":["AKASH CERAMIC FEEDER","ITLA ONGC FEEDER - LG1","MANSA CITY FEEDER","MANSA CIVIL FEEDER"],
"LIMBODARA-GGS-2":["ITLA ONGC FEEDER - LG2","KIRTIDHAM FEEDER","LISA FEEDER","MAHAKALI FEEDER","MUBARAKPUR FEEDER","NETRA FEEDER","ROYAL FEEDER","TIRUPATI FEEDER","VARDAYINI FEEDER"],
"GAMIJ-GGS-1":["BAHIYAL ONGC FEEDER","RAM FEEDER - GAMIJ-1","SOMNATH JGY FEEDER","NAYRA JGY FEEDER","VASNA RATHOD FEEDER"],
"GAMIJ-GGS-2":["BADARPUR FEEDER","CHAULAJ FFEDER - GAMIJ - 2","GADWEL FEEDER","KASHTABHANJAN FEEDER","RAM FEEDR - GAMIJ-2"],
"GAMIJ-GGS-3":["BARMUVADA FEEDER","CHAULAJ FEEDER - GAMIJ - 3","FINAV FEEEDER","FUDAL MATA FEEDER","GAYATRI FEEDER","GINJAR FEEDER","HALDARWAS FEEDER GAMIJ - 3","HALDARWAS FEEDER GAMIJ - 4","KALPSAR FEEDER","SATRUNDA FEEDER - GAMIJ - 3","SATRUNDA FEEDER - GAMIJ - 4","SIHUNJ FEEDER","VANSOLI FEEDER"],
"MOTERA-GGS":["PREKSHA BHARTI INFOCITY FEEDER","TP - 44 FEEDER","ZUNDAL AG FEEDER"]
};

// Single login credential
const LOGIN_CREDENTIALS={username:"cpf", password:"1234"};

let loggedIn={};

// Login function
function login(){
  const user=document.getElementById("loginUser").value.trim();
  const pass=document.getElementById("loginPass").value.trim();
  const name=document.getElementById("loginName").value.trim();
  const inst=document.getElementById("loginInst").value.trim();

  if(!user||!pass||!name||!inst){
    showMsg("All login fields are required");
    return;
  }

  if(user===LOGIN_CREDENTIALS.username && pass===LOGIN_CREDENTIALS.password){
    loggedIn={name:name, installation:inst};
    showMsg("Login successful: "+name);
    document.getElementById("loginCard").style.display="none";
    document.getElementById("shutdownCard").style.display="block";
    document.getElementById("resumeCard").style.display="block";
    populateFeeders();
  } else {
    showMsg("Invalid username or password");
  }
}

// Populate feeders based on installation
function populateFeeders(){
  const sd=document.getElementById("sd_feeder");
  const rs=document.getElementById("rs_feeder");
  sd.innerHTML='<option value="">Select Feeder</option>';
  rs.innerHTML='<option value="">Select Feeder</option>';
  (INSTALLATION_FEEDERS[loggedIn.installation]||[]).forEach(f=>{
    sd.innerHTML+=`<option>${f}</option>`;
    rs.innerHTML+=`<option>${f}</option>`;
  });
}

// Submit Shutdown
function submitShutdown(){
  if(!sd_feeder.value||!sd_time.value){
    showMsg("Feeder and Shutdown Time required");
    return;
  }
  fetch(WEBAPP_URL+'?'+new URLSearchParams({
    action:'shutdown',
    Installation:loggedIn.installation,
    feeder:sd_feeder.value,
    ShutdownTime:sd_time.value.replace("T"," "),
    ShutdownType:sd_type.value,
    Information:sd_info.value,
    ShutdownEntryBy:loggedIn.name
  }),{mode:'no-cors'});
  showMsg("Shutdown submitted successfully");
}

// Submit Resume
function submitResume(){
  if(!rs_feeder.value||!rs_time.value){
    showMsg("Feeder and Resume Time required");
    return;
  }
  fetch(WEBAPP_URL+'?'+new URLSearchParams({
    action:'resume',
    feeder:rs_feeder.value,
    ResumeTime:rs_time.value.replace("T"," "),
    TotalProdLoss:rs_loss.value,
    DGDeployed:rs_dg.value,
    Remarks:rs_rem.value,
    ResumeEntryBy:loggedIn.name
  }),{mode:'no-cors'});
  showMsg("Resume submitted successfully");
}

// Show message
function showMsg(t){
  msg.innerText=t;
  setTimeout(()=>msg.innerText="",3000);
}
</script>

</body>
</html>
