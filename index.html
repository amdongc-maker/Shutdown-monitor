<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shutdown & Resume</title>

<style>
body{font-family:Segoe UI,Arial;background:#f4f6f8;margin:0}
header{background:#1f3a5f;color:#fff;padding:12px 20px;font-size:20px}
.container{padding:20px}
.card{background:#fff;padding:20px;border-radius:6px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
h2{margin-top:0}
label{font-weight:600}
input,select,textarea{width:100%;padding:8px;margin-top:5px;margin-bottom:15px}
button{padding:10px 20px;border:none;border-radius:4px;font-size:15px;cursor:pointer}
.red{background:#e74c3c;color:#fff}
.green{background:#27ae60;color:#fff}
.shutdown-item{background:#ffeaea;padding:10px;border-left:5px solid #e74c3c;margin-bottom:8px}
</style>
</head>

<body>

<header>Shutdown / Resume System</header>

<div class="container">

<div class="card">
<h2>Operator Details</h2>
<label>Operator Name</label>
<input id="opName" value="SANDESH BHARDWAJ">

<label>Installation</label>
<input id="install" value="LIMBODARA-GGS-2">
</div>

<div class="card">
<h2>Active Shutdown Feeders</h2>
<div id="activeShutdowns"><i>Loading...</i></div>
<br>
<button class="red">Shutdown Entry</button>
<button class="green">Resume Entry</button>
</div>

<div class="card">
<h2>Shutdown Entry</h2>
<label>Feeder</label>
<input value="ITLA ONGC FEEDER - LG2">

<label>Shutdown Time</label>
<input value="02-01-2026 09:28">

<label>Shutdown Type</label>
<input value="PLAN PSD">

<label>Information</label>
<textarea>VV</textarea>
</div>

</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/12Vb60sr_ApZ6JBpE2D_nZweJhTk7DLDEf9XHfpIbJzQ/export?format=csv"

const activeDiv = document.getElementById("activeShutdowns");

function normalize(v){
 return (v||"").trim().toUpperCase();
}

function loadActiveShutdowns(){

 fetch(CSV_URL + "&t=" + Date.now())
 .then(r=>r.text())
 .then(text=>{

  const rows = text.split("\n").map(r=>r.split(","));
  const header = rows.shift().map(h=>normalize(h));

  const idx = {
   feeder: header.findIndex(h=>h.includes("FEEDER")),
   shutdown: header.findIndex(h=>h.includes("SHUTDOWN")),
   resume: header.findIndex(h=>h.includes("RESUME")),
   install: header.findIndex(h=>h.includes("INSTALL"))
  };

  const curInstall = normalize(document.getElementById("install").value);
  activeDiv.innerHTML="";
  let found=false;

  rows.forEach(r=>{
   if(!r[idx.feeder]) return;

   const install = normalize(r[idx.install]);
   const resume  = normalize(r[idx.resume]);

   // üî• CORE LOGIC ‚Äî THIS WAS THE ISSUE
   if(
     install === curInstall &&
     (resume === "" || resume === "NA")
   ){
    found=true;
    activeDiv.innerHTML += `
     <div class="shutdown-item">
      <b>${r[idx.feeder]}</b><br>
      Shutdown @ ${r[idx.shutdown]}
     </div>`;
   }
  });

  if(!found){
   activeDiv.innerHTML="<i>No Active Shutdown</i>";
  }
 })
 .catch(e=>{
  activeDiv.innerHTML="<span style='color:red'>CSV Load Error</span>";
 });
}

// ‚è± AUTO REFRESH EVERY 30 SEC
loadActiveShutdowns();
setInterval(loadActiveShutdowns,30000);
</script>

</body>
</html>
