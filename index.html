<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>POWER SHUTDOWN MANAGEMENT APP - AREA-IV</title>

<style>
/* ===== APP BASE ===== */
body{
  font-family: "Segoe UI", Roboto, Arial;
  background:#f1f3f6;
  margin:0;
}

/* ===== HEADER ===== */
header{
  background:#1f3a5f;
  color:#fff;
  padding:14px 18px;
  font-size:18px;
  font-weight:600;
  text-align:center;
}

/* ===== MAIN CONTAINER ===== */
.container{
  padding:16px;
  max-width:480px;
  margin:auto;
}

/* ===== SCREENS (NO BORDERS) ===== */
.card{
  background:transparent;
  padding:0;
  margin-bottom:20px;
  box-shadow:none;
  border-radius:0;
}

/* ===== TITLES ===== */
h2,h3{
  margin:12px 0;
  color:#1f3a5f;
  text-align:center;
}

/* ===== LABELS ===== */
label{
  margin-top:14px;
  font-weight:600;
  color:#444;
  font-size:14px;
}

/* ===== INPUTS ===== */
input,select,textarea{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #dcdfe4;
  font-size:15px;
  background:#fff;
}

input:focus,select:focus,textarea:focus{
  outline:none;
  border-color:#1f3a5f;
}

/* ===== BUTTONS ===== */
button{
  width:100%;
  padding:14px;
  margin-top:14px;
  font-size:16px;
  font-weight:600;
  border:none;
  border-radius:14px;
  cursor:pointer;
}

/* ===== BUTTON COLORS ===== */
.btn-login{background:#1f3a5f;color:#fff}
.btn-shutdown{background:#e74c3c;color:#fff}
.btn-resume{background:#27ae60;color:#fff}
.btn-back{background:#7f8c8d;color:#fff}

/* ===== ACTIVE SHUTDOWN LIST ===== */
.shutdown-item{
  background:#fff;
  border-radius:14px;
  padding:14px;
  margin-bottom:10px;
  box-shadow:0 3px 10px rgba(0,0,0,.08);
  font-size:14px;
}

/* ===== MESSAGE ===== */
#msg{
  text-align:center;
  margin-top:10px;
  font-weight:600;
  color:#1f3a5f;
}

/* ===== HIDE ===== */
.hidden{display:none}

/* ===== MOBILE APP FEEL ===== */
@media (min-width:600px){
  .container{
    margin-top:20px;
  }
}
</style>
</head>

<body>

<header>POWER SHUTDOWN MANAGEMENT APP - AREA-IV</header>

<div class="container">

<!-- LOGIN -->
<div class="card" id="loginBox">
<h3>Operator Login</h3>
<label>Username</label>
<input id="loginUser">
<label>Password</label>
<input type="password" id="loginPass"><br><br>
<button class="btn-login" onclick="login()">Login</button>
</div>

<!-- MAIN DASHBOARD -->
<div class="card hidden" id="mainBox">
<h2>ACTIVE SHUTDOWN FEEDERS</h2>
<div id="activeShutdowns">Loading...</div><br>
<button class="btn-shutdown" onclick="openShutdown()">Shutdown</button>
<button class="btn-resume" onclick="openResume()">Resume</button>
</div>

<!-- SHUTDOWN -->
<div class="card hidden" id="shutdownBox">
<h3>Shutdown Entry</h3>
<label>Feeder</label>
<select id="sd_feeder"></select>
<label>Shutdown Time</label>
<input type="datetime-local" id="sd_time">
<label>Shutdown Type</label>
<select id="sd_type">
<option>PLAN PSD</option>
<option>PARTIAL PLAN PSD</option>
<option>UNPLAN PSD</option>
<option>PARTIAL UNPLAN PSD</option>
</select>
<label>Information</label>
<textarea id="sd_info"></textarea><br>
<button class="btn-shutdown" onclick="submitShutdown()">Submit</button>
<button class="btn-back" onclick="backToMain()">Back</button>
</div>

<!-- RESUME -->
<div class="card hidden" id="resumeBox">
<h3>Resume Entry</h3>
<label>Feeder</label>
<select id="rs_feeder"></select>
<label>Resume Time</label>
<input type="datetime-local" id="rs_time">
<label>Production Loss</label>
<input id="rs_loss">
<label>DG Deployed</label>
<input id="rs_dg">
<label>Remarks</label>
<textarea id="rs_rem"></textarea><br>
<button class="btn-resume" onclick="submitResume()">Submit</button>
<button class="btn-back" onclick="backToMain()">Back</button>
</div>

<div id="msg"></div>
</div>

<script>
/* ================= CONFIG ================= */
const WEBAPP_URL="https://script.google.com/macros/s/AKfycbz1g6vziMziteLRvxrVRtVr-xUOFdLrpDN4OqoiaDEv-c2h1-fUHk9nq2LueN4XuHHsKQ/exec";
const CSV_URL="https://docs.google.com/spreadsheets/d/12Vb60sr_ApZ6JBpE2D_nZweJhTk7DLDEf9XHfpIbJzQ/export?format=csv";

/* USERS */
const USERS=[
 {u:"124569",p:"1234",n:"KULDIP KHAROLIA",i:"LIMBODARA-GGS-1"},
 {u:"133668",p:"1234",n:"DIPAK MAURYA",i:"LIMBODARA-GGS-1"},
 {u:"124470",p:"1234",n:"SANDESH BHARDWAJ",i:"LIMBODARA-GGS-2"},
 {u:"135597",p:"1234",n:"KUNAL RANJAN",i:"LIMBODARA-GGS-2"},
 {u:"139938",p:"1234",n:"HAREKRISHNA",i:"LIMBODARA-GGS-2"},
 {u:"125223",p:"1234",n:"SUKUMAR LAHA",i:"GAMIJ-GGS-1"},
 {u:"139649",p:"1234",n:"RAVI KUMAR SHARMA",i:"GAMIJ-GGS-1"},
 {u:"137217",p:"1234",n:"SONUKUMAR SINGH",i:"GAMIJ-GGS-1"},
 {u:"121028",p:"1234",n:"ABHISHEK PATEL",i:"GAMIJ-GGS-2"},
 {u:"133181",p:"1234",n:"KETUL PATEL",i:"GAMIJ-GGS-2"},
 {u:"123310",p:"1234",n:"DHEERENDRA SINGH",i:"GAMIJ-GGS-3"},
 {u:"133643",p:"1234",n:"ASHUTOSH KUMAR SINGH",i:"GAMIJ-GGS-3"},
 {u:"135515",p:"1234",n:"ADITYA ARYA",i:"GAMIJ-GGS-3"},
 {u:"130594",p:"1234",n:"MAHESH GAJJAR",i:"MOTERA-GGS"},
 {u:"95606",p:"1234",n:"SUDHIR SINGH",i:"ST(ELECTRICAL)"},
 {u:"95843",p:"1234",n:"DIPAK MEDAK",i:"ST(ELECTRICAL)"},
 {u:"82653",p:"1234",n:"SHANTILAL RATHWA",i:"FMP(E)"},
 {u:"82051",p:"1234",n:"HEMENDRA KUMAR",i:"SAM4"},

];

/* FEEDERS */
const FEEDERS={
"LIMBODARA-GGS-1":["AKASH CERAMIC FEEDER","ITLA ONGC FEEDER-LG1","MANSA CITY FEEDER","MANSA CIVIL FEEDER"],
"LIMBODARA-GGS-2":["ITLA ONGC FEEDER-LG2","KIRTIDHAM FEEDER","LISA FEEDER","MAHAKALI FEEDER","MUBARAKPUR FEEDER","NETRA FEEDER","ROYAL FEEDER","TIRUPATI FEEDER","VARDAYINI FEEDER"],
"GAMIJ-GGS-1":["BAHIYAL ONGC FEEDER","RAM FEEDER-GAMIJ-1","SOMNATH JGY FEEDER","NAYRA JGY FEEDER","VASNA RATHOD FEEDER"],
"GAMIJ-GGS-2":["BADARPUR FEEDER","CHAULAJ FEEDER-GAMIJ-2","GADWEL FEEDER","KASHTABHANJAN FEEDER","RAM FEEDR-GAMIJ-2"],
"GAMIJ-GGS-3":["BARMUVADA FEEDER","CHAULAJ FEEDER-GAMIJ-3","FINAV FEEEDER","FUDAL MATA FEEDER","GAYATRI FEEDER","GINJAR FEEDER","HALDARWAS FEEDER-GAMIJ-3","HALDARWAS FEEDER-GAMIJ-4","KALPSAR FEEDER","SATRUNDA FEEDER-GAMIJ-3","SATRUNDA FEEDER-GAMIJ-4","SIHUNJ FEEDER,VANSOLI FEEDER","BADARPUR FEEDER","CHAULAJ FFEDER-GAMIJ-2","GADWEL FEEDER","KASHTABHANJAN FEEDER","RAM FEEDR-GAMIJ-2"],
"MOTERA-GGS":["PREKSHA BHARTI INFOCITY FEEDER","TP-44 FEEDER","ZUNDAL AG FEEDER"],
"ST(ELECTRICAL)":["AKASH CERAMIC FEEDER","ITLA ONGC FEEDER-LG1","MANSA CITY FEEDER","MANSA CIVIL FEEDER","ITLA ONGC FEEDER-LG2","KIRTIDHAM FEEDER","LISA FEEDER","MAHAKALI FEEDER","MUBARAKPUR FEEDER","NETRA FEEDER","ROYAL FEEDER","TIRUPATI FEEDER","VARDAYINI FEEDER","BAHIYAL ONGC FEEDER","RAM FEEDER-GAMIJ-1","SOMNATH JGY FEEDER","NAYRA JGY FEEDER","VASNA RATHOD FEEDER","BARMUVADA FEEDER","CHAULAJ FEEDER-GAMIJ-3","FINAV FEEDER","FUDAL MATA FEEDER","GAYATRI FEEDER","GINJAR FEEDER","HALDARWAS FEEDER-GAMIJ-3","HALDARWAS FEEDER-GAMIJ-4","KALPSAR FEEDER","SATRUNDA FEEDER-GAMIJ-3","SATRUNDA FEEDER-GAMIJ-4","SIHUNJ FEEDER,VANSOLI FEEDER","BADARPUR FEEDER","CHAULAJ FFEDER-GAMIJ-2","GADWEL FEEDER","KASHTABHANJAN FEEDER","RAM FEEDR-GAMIJ-2","PREKSHA BHARTI INFOCITY FEEDER","TP-44 FEEDER","ZUNDAL AG FEEDER"],
"FMP(E)":["AKASH CERAMIC FEEDER","ITLA ONGC FEEDER-LG1","MANSA CITY FEEDER","MANSA CIVIL FEEDER","ITLA ONGC FEEDER-LG2","KIRTIDHAM FEEDER","LISA FEEDER","MAHAKALI FEEDER","MUBARAKPUR FEEDER","NETRA FEEDER","ROYAL FEEDER","TIRUPATI FEEDER","VARDAYINI FEEDER","BAHIYAL ONGC FEEDER","RAM FEEDER-GAMIJ-1","SOMNATH JGY FEEDER","NAYRA JGY FEEDER","VASNA RATHOD FEEDER","BARMUVADA FEEDER","CHAULAJ FEEDER-GAMIJ-3","FINAV FEEDER","FUDAL MATA FEEDER","GAYATRI FEEDER","GINJAR FEEDER","HALDARWAS FEEDER-GAMIJ-3","HALDARWAS FEEDER-GAMIJ-4","KALPSAR FEEDER","SATRUNDA FEEDER-GAMIJ-3","SATRUNDA FEEDER-GAMIJ-4","SIHUNJ FEEDER,VANSOLI FEEDER","BADARPUR FEEDER","CHAULAJ FFEDER-GAMIJ-2","GADWEL FEEDER","KASHTABHANJAN FEEDER","RAM FEEDR-GAMIJ-2","PREKSHA BHARTI INFOCITY FEEDER","TP-44 FEEDER","ZUNDAL AG FEEDER"],
"SAM4":["AKASH CERAMIC FEEDER","ITLA ONGC FEEDER-LG1","MANSA CITY FEEDER","MANSA CIVIL FEEDER","ITLA ONGC FEEDER-LG2","KIRTIDHAM FEEDER","LISA FEEDER","MAHAKALI FEEDER","MUBARAKPUR FEEDER","NETRA FEEDER","ROYAL FEEDER","TIRUPATI FEEDER","VARDAYINI FEEDER","BAHIYAL ONGC FEEDER","RAM FEEDER-GAMIJ-1","SOMNATH JGY FEEDER","NAYRA JGY FEEDER","VASNA RATHOD FEEDER","BARMUVADA FEEDER","CHAULAJ FEEDER-GAMIJ-3","FINAV FEEDER","FUDAL MATA FEEDER","GAYATRI FEEDER","GINJAR FEEDER","HALDARWAS FEEDER-GAMIJ-3","HALDARWAS FEEDER-GAMIJ-4","KALPSAR FEEDER","SATRUNDA FEEDER-GAMIJ-3","SATRUNDA FEEDER-GAMIJ-4","SIHUNJ FEEDER,VANSOLI FEEDER","BADARPUR FEEDER","CHAULAJ FFEDER-GAMIJ-2","GADWEL FEEDER","KASHTABHANJAN FEEDER","RAM FEEDR-GAMIJ-2","PREKSHA BHARTI INFOCITY FEEDER","TP-44 FEEDER","ZUNDAL AG FEEDER"]
};

let CURRENT_USER={};

/* ================= LOGIN ================= */
function login(){
 const u=loginUser.value.trim();
 const p=loginPass.value.trim();
 const user=USERS.find(x=>x.u===u && x.p===p);
 if(!user){showMsg("Invalid Login");return;}
 CURRENT_USER=user;
 loginBox.classList.add("hidden");
 mainBox.classList.remove("hidden");
 populateFeeders();
 loadActiveShutdowns();
 showMsg("Welcome "+user.n);
}

/* ================= NAV ================= */
function openShutdown(){
 mainBox.classList.add("hidden");
 shutdownBox.classList.remove("hidden");
}
function openResume(){
 mainBox.classList.add("hidden");
 resumeBox.classList.remove("hidden");
}
function backToMain(){
 shutdownBox.classList.add("hidden");
 resumeBox.classList.add("hidden");
 mainBox.classList.remove("hidden");
 loadActiveShutdowns();
}

/* ================= FEEDERS ================= */
function populateFeeders(){
 sd_feeder.innerHTML=rs_feeder.innerHTML="";
 (FEEDERS[CURRENT_USER.i]||[]).forEach(f=>{
  sd_feeder.innerHTML+=`<option>${f}</option>`;
  rs_feeder.innerHTML+=`<option>${f}</option>`;
 });
}

/* ================= ACTIVE SHUTDOWN ================= */
function loadActiveShutdowns(){
 fetch(CSV_URL+"&t="+Date.now())
 .then(r=>r.text())
 .then(t=>{
  const rows=t.split("\n").map(r=>r.split(","));
  const h=rows.shift().map(x=>x.toUpperCase());
  const idx={
   feeder:h.findIndex(x=>x.includes("FEEDER")),
   sd:h.findIndex(x=>x.includes("SHUTDOWN")),
   rs:h.findIndex(x=>x.includes("RESUME")),
   inst:h.findIndex(x=>x.includes("INSTALL"))
  };
  activeShutdowns.innerHTML="";
  let found=false;
  rows.forEach(r=>{
   if(r[idx.inst]?.trim()===CURRENT_USER.i &&
      (!r[idx.rs]||r[idx.rs].trim()==="NA")){
    found=true;
    activeShutdowns.innerHTML+=`
     <div class="shutdown-item">
      <b>${r[idx.feeder]}</b><br>
      Shutdown @ ${r[idx.sd]}
     </div>`;
   }
  });
  if(!found) activeShutdowns.innerHTML="<i>No Active Shutdown</i>";
 });
}
setInterval(loadActiveShutdowns,30000);

/* ================= SUBMIT ================= */
function submitShutdown(){
 fetch(WEBAPP_URL+"?"+new URLSearchParams({
  action:"shutdown",
  feeder:sd_feeder.value,
  ShutdownTime:sd_time.value.replace("T"," "),
  ShutdownType:sd_type.value,
  Information:sd_info.value,
  ShutdownEntryBy:CURRENT_USER.n,
  Installation:CURRENT_USER.i
 }),{mode:"no-cors"});
 showMsg("Shutdown Submitted");
 backToMain();
}

function submitResume(){
 fetch(WEBAPP_URL+"?"+new URLSearchParams({
  action:"resume",
  feeder:rs_feeder.value,
  ResumeTime:rs_time.value.replace("T"," "),
  ResumeEntryBy:CURRENT_USER.n,
  TotalProdLoss:rs_loss.value,
  DGDeployed:rs_dg.value,
  Remarks:rs_rem.value
 }),{mode:"no-cors"});
 showMsg("Resume Submitted");
 backToMain();
}

/* ================= MSG ================= */
function showMsg(t){
 msg.innerText=t;
 setTimeout(()=>msg.innerText="",3000);
}
</script>

</body>
</html>
