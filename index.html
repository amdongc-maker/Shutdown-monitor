<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shutdown & Resume Power Management</title>

<style>
body{font-family:Segoe UI,Arial;background:#f4f6f8;margin:0}
header{background:#1f3a5f;color:#fff;padding:12px 20px;font-size:20px}
.container{padding:20px}
.card{background:#fff;padding:20px;border-radius:6px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
h3{margin-top:0;color:#1f3a5f}
label{display:block;margin-top:10px;font-weight:600}
select,input,textarea{width:100%;padding:8px;margin-top:4px}
textarea{resize:vertical}
button{padding:10px 18px;border:none;border-radius:4px;cursor:pointer}
.btn-shutdown{background:#e74c3c;color:#fff}
.btn-resume{background:#27ae60;color:#fff}
.btn-refresh{background:#3498db;color:#fff}
.footer{position:fixed;bottom:0;width:100%;background:#ecf0f1;padding:10px;text-align:center}
#msg{margin-top:5px;font-weight:bold}
</style>
</head>

<body>

<header>Shutdown & Resume Power Management</header>

<div class="container">

<div class="card">
<label>Select Installation</label>
<select id="main_inst"></select>
</div>

<div class="card">
<h3>Active Shutdown Feeders</h3>
<table width="100%" border="1" cellpadding="6">
<thead style="background:#eee">
<tr>
<th>Feeder</th>
<th>Shutdown Time</th>
<th>Type</th>
<th>Information</th>
</tr>
</thead>
<tbody id="shutdownList"></tbody>
</table>
</div>

<div class="card">
<h3>Shutdown Entry</h3>

<label>Installation</label>
<select id="sd_inst"></select>

<label>Feeder</label>
<select id="sd_feeder"></select>

<label>Shutdown Time</label>
<input type="datetime-local" id="sd_time">

<label>Shutdown Type</label>
<select id="sd_type">
<option>PLAN PSD</option>
<option>PARTIAL PLAN PSD</option>
<option>UNPLAN PSD</option>
<option>PARTIAL UNPLAN PSD</option>
</select>

<label>Information</label>
<textarea id="sd_info"></textarea>

<br><br>
<button class="btn-shutdown" onclick="submitShutdown()">Submit Shutdown</button>
</div>

<div class="card">
<h3>Resume Entry</h3>

<label>Installation</label>
<select id="rs_inst"></select>

<label>Feeder</label>
<select id="rs_feeder"></select>

<label>Resume Time</label>
<input type="datetime-local" id="rs_time">

<label>Production Loss</label>
<input type="number" id="rs_loss">

<label>DG Deployed</label>
<input type="number" id="rs_dg">

<label>Remarks</label>
<textarea id="rs_rem"></textarea>

<br><br>
<button class="btn-resume" onclick="submitResume()">Submit Resume</button>
</div>

</div>

<div class="footer">
<button class="btn-refresh" onclick="loadActive()">Refresh</button>
<div id="msg"></div>
</div>

<script>
const WEBAPP_URL="https://script.google.com/macros/s/AKfycbz1g6vziMziteLRvxrVRtVr-xUOFdLrpDN4OqoiaDEv-c2h1-fUHk9nq2LueN4XuHHsKQ/exec";

const INSTALLATION_FEEDERS={
"LIMBODARA-GGS-1":["AKASH CERAMIC FEEDER","ITLA ONGC FEEDER - LG1","MANSA CITY FEEDER","MANSA CIVIL FEEDER"],
"LIMBODARA-GGS-2":["ITLA ONGC FEEDER - LG2","KIRTIDHAM FEEDER","LISA FEEDER","MAHAKALI FEEDER","MUBARAKPUR FEEDER","NETRA FEEDER","ROYAL FEEDER","TIRUPATI FEEDER","VARDAYINI FEEDER"],
"GAMIJ-GGS-1":["BAHIYAL ONGC FEEDER","RAM FEEDER - GAMIJ-1","SOMNATH JGY FEEDER","NAYRA JGY FEEDER","VASNA RATHOD FEEDER"],
"GAMIJ-GGS-2":["BADARPUR FEEDER","CHAULAJ FFEDER - GAMIJ - 2","GADWEL FEEDER","KASHTABHANJAN FEEDER","RAM FEEDR - GAMIJ-2"],
"GAMIJ-GGS-3":["BARMUVADA FEEDER","CHAULAJ FEEDER - GAMIJ - 3","FINAV FEEEDER","FUDAL MATA FEEDER","GAYATRI FEEDER","GINJAR FEEDER","HALDARWAS FEEDER GAMIJ - 3","HALDARWAS FEEDER GAMIJ - 4","KALPSAR FEEDER","SATRUNDA FEEDER - GAMIJ - 3","SATRUNDA FEEDER - GAMIJ - 4","SIHUNJ FEEDER","VANSOLI FEEDER"],
"MOTERA-GGS":["PREKSHA BHARTI INFOCITY FEEDER","TP - 44 FEEDER","ZUNDAL AG FEEDER"]
};

function init(){
["main_inst","sd_inst","rs_inst"].forEach(id=>{
let s=document.getElementById(id);
s.innerHTML='<option value="">Select Installation</option>';
Object.keys(INSTALLATION_FEEDERS).forEach(i=>s.innerHTML+=`<option>${i}</option>`);
});
bind("sd_inst","sd_feeder");
bind("rs_inst","rs_feeder");
main_inst.onchange=loadActive;
}

function bind(i,f){
document.getElementById(i).onchange=function(){
let x=document.getElementById(f);
x.innerHTML='<option value="">Select Feeder</option>';
(INSTALLATION_FEEDERS[this.value]||[]).forEach(a=>x.innerHTML+=`<option>${a}</option>`);
};
}

function loadActive(){
fetch(WEBAPP_URL+'?action=status&t='+Date.now())
.then(r=>r.json())
.then(d=>{
shutdownList.innerHTML='';
const rows=d.filter(x=>!main_inst.value||x.installation===main_inst.value);

if(rows.length===0){
shutdownList.innerHTML='<tr><td colspan="4">No Active Shutdown</td></tr>';
return;
}

rows.forEach(x=>{
shutdownList.innerHTML+=
`<tr>
<td>${x.feeder}</td>
<td>${x.shutdownTime}</td>
<td>${x.type}</td>
<td>${x.information}</td>
</tr>`;
});
});
}

function submitShutdown(){
if(!sd_inst.value||!sd_feeder.value||!sd_time.value){
showMsg("All shutdown fields required");
return;
}
fetch(WEBAPP_URL+'?'+new URLSearchParams({
action:'shutdown',
Installation:sd_inst.value,
feeder:sd_feeder.value,
ShutdownTime:sd_time.value.replace("T"," "),
ShutdownType:sd_type.value,
Information:sd_info.value
}),{mode:'no-cors'});
showMsg("Shutdown submitted successfully");
setTimeout(loadActive,1500);
}

function submitResume(){
fetch(WEBAPP_URL+'?'+new URLSearchParams({
action:'resume',
feeder:rs_feeder.value,
ResumeTime:rs_time.value.replace("T"," "),
TotalProdLoss:rs_loss.value,
DGDeployed:rs_dg.value,
Remarks:rs_rem.value
}),{mode:'no-cors'});
showMsg("Resume submitted successfully");
setTimeout(loadActive,1500);
}

function showMsg(t){
msg.innerText=t;
setTimeout(()=>msg.innerText="",2500);
}

init();
loadActive();
</script>

</body>
</html>
